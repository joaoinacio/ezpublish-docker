dbvol:
  image: ubuntu:trusty
  volumes:
   - volumes/mysql:/var/lib/mysql
ezpublishvol:
  image: ubuntu:trusty
  volumes:
   - volumes/ezpublish:/var/www
composercachevol:
  image: ubuntu:trusty
  volumes:
   - volumes/composercache:/volumes/composercache
etcd:
  build: dockerfiles/ubuntu/etcd
  volumes:
   - volumes/etcd:/volumes/etcd
  environment:
   - START_ETCD
   - ETCD_DISCOVERY
   - ETCD_NAME
  ports:
   - "4001:4001"
   - "7001:7001"
db1:
  build: dockerfiles/ubuntu/mysql
  volumes_from:
   - dbvol
  environment:
   - MYSQL_PASS
   - ETCD_ENABLED
prepare:
  build: dockerfiles/ubuntu/ezpublish/prepare
  links:
   - db1:db
  volumes_from:
   - ezpublishvol
   - composercachevol
  volumes:
   - ${EZ_TARBALL_FILENAME}:/tmp/ezpublish.tar.gz
  environment:
   - EZ_KICKSTART
   - EZ_KICKSTART_FROM_TEMPLATE
   - EZ_PACKAGEURL
   - EZ_INSTALLTYPE
   - EZ_COMPOSERVERSION
   - EZ_COMPOSERREPOSITORYURL
   - EZ_ENVIRONMENT
   - EZ_PATCH_SW
solrprepare:
  build: dockerfiles/ubuntu/ezpublish/solr_prepare
  links:
    - solr:solr
    - db1:db
  volumes_from:
    - ezpublishvol
  environment:
    - SOLR_ENABLED
    - EZ_ENVIRONMENT
phpfpm:
  build: dockerfiles/ubuntu/php-fpm
  links:
   - db1:db
   - solr:solr
  volumes_from:
   - ezpublishvol
  environment:
   - ETCD_ENABLED
phpcli:
  build: dockerfiles/ubuntu/php-cli
  links:
   - db1:db
   - solr:solr
  volumes_from:
   - ezpublishvol
nginx:
  build: dockerfiles/ubuntu/nginx
  links:
   - phpfpm:php_fpm
  volumes_from:
   - ezpublishvol
  ports:
   - "8080:80"
  environment:
   - ETCD_ENABLED
   - EZ_ENVIRONMENT
sahi:
  build: dockerfiles/ubuntu/sahi
  links:
   - nginx:web
  ports:
   - "9999:9999"
   - "5900:5900"
behatphpcli:
  build: dockerfiles/ubuntu/php-cli
  links:
   - db1:db
   - nginx:web
   - sahi:sahi
  volumes_from:
   - ezpublishvol
solr:
  image: makuk66/docker-solr
  ports:
   - "8983:8983"
  volumes:
   - volumes/solr/schema/schema.xml:/opt/solr/example/solr/collection1/conf/schema.xml
